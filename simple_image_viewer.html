<!DOCTYPE html>
<head>
  <meta charset="UTF-8">
</head>
<body>
  <script>
    (function() {
      "use strict";

      // e.g.
      // ./画像ファイル名_001.jpg
      var file_path         = "./画像ファイル名_";
      var zero_suppress_num = 3;
      var file_extension    = ".jpg";

      function get_page_from_hash() {
        var page_string = location.hash.substring(1);
        var page        = parseInt(page_string, 10);

        if (isFinite(page) === false || page < 1) {
          page = 1;
        }

        return page;
      }

      function set_page_to_hash(page) {
        var zero_paddinged_page = get_zero_padding_page(page);
        var path_hash = "#" + zero_paddinged_page;

        update_image(zero_paddinged_page);

        history.pushState(null, null, path_hash);
      }

      function get_zero_padding_page(page) {
        return (zero_padding_string + page).slice(-zero_suppress_num);
      }

      function update_image(zero_paddinged_page) {
        image.src = file_path + zero_paddinged_page + file_extension;
      }

      function set_image_margin_bottom(margin_bottom) {
        image.style.marginBottom = margin_bottom + "px";
      }

      function reset_image_margin_bottom() {
        set_image_margin_bottom(innerHeight);
      }

      function delete_image_margin_bottom() {
        set_image_margin_bottom(0);
      }

      function set_onmousemove() {
        function set_cursor(cursor_style) {
          document.body.style.cursor = cursor_style;
        }

        addEventListener("mousemove", function(e) {
          if (e.clientX < innerWidth / 2) {
            // カーソルが左半分にある / 左向きカーソル
            set_cursor("w-resize");
          }
          else {
            // カーソルが右半分にある / 右向きカーソル
            set_cursor("e-resize");
          }
        }, false);
      }

      function set_move_page_events() {
        function set_scroll_page(scroll_top) {
          scrollTo(0, scroll_top);
        }

        function move_previous_page() {
          var page = get_page_from_hash();

          if (page === 1) {
            return;
          }

          set_page_to_hash(page - 1);

          // 画面は一番下にスクロールした状態にする
          // いったん画像下のマージンは消す
          delete_image_margin_bottom();

          // 一番下にスクロール
          set_scroll_page(document.body.clientHeight);

          // スクロールが終わってから画像下のマージンをリセットする
          reset_image_margin_bottom();
        }

        function move_next_page() {
          var page = get_page_from_hash();

          set_page_to_hash(page + 1);

          // 画面はスクロールしていない状態にする
          set_scroll_page(0);
        }

        addEventListener("mousedown", function(e) {
          if (e.clientX < innerWidth / 2) {
            // 左半分クリック
            move_previous_page();
          }
          else {
            // 右半分クリック
            move_next_page();
          }
        }, false);

        var RECEIVE_KEY_LIST_AND_EXEC_FUNCTIONS = {
          Enter:      move_next_page,     // result chrome, firefox, safari
          ArrowRight: move_next_page,     // result chrome, firefox
          ArrowLeft:  move_previous_page, // result chrome, firefox
          Right:      move_next_page,     // result safari
          Left:       move_previous_page, // result safari
        };

        addEventListener("keydown", function(e) {
          // e.key           chrome, firefox
          // e.keyIdentifier safari
          var received_key  = e.key || e.keyIdentifier;
          var exec_function = RECEIVE_KEY_LIST_AND_EXEC_FUNCTIONS[received_key];

          if (exec_function) {
            exec_function();
          }
        }, false);
      }

      function set_onresize() {
        addEventListener("resize", function(e) {
          reset_image_margin_bottom();
        }, false);
      }

      function initialize() {
        // imgタグ作成
        image = document.createElement("img");
        image.style.width = "100%";

        document.body.appendChild(image);

        // 画像と背景の境目が分かりやすいように背景色を設定する。とりあえず灰色
        document.body.style.backgroundColor = "#dddddd";

        zero_padding_string = new Array(zero_suppress_num).fill("0").join("");

        var page = get_page_from_hash();

        set_page_to_hash(page);
        reset_image_margin_bottom();

        set_onmousemove();
        set_move_page_events();
        set_onresize();
      }

      var image;
      var zero_padding_string;

      addEventListener("DOMContentLoaded", initialize, false);
    })();
  </script>
</body>
</heml>
