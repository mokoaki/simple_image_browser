<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
</head>
<body>
  <script>
    (function(window) {
      "use strict";

      var Setting = {
        // e.g.
        // ./path/to/file_name_001.jpg
        file_path:         "./path/to/file_name_",
        zero_suppress_num: 3,
        file_extension:    ".jpg",
      };

      var Image = {
        init: function() {
          this.element = window.document.createElement("img");
          this.element.style.width = "100%";
          window.document.body.appendChild(this.element);

          this.reset_margin_bottom_and_top();
        },

        update: function(function_after_image_load) {
          this.call_function_after_image_load = function_after_image_load;
          this.element.src = Setting.file_path + Page.get_zero_padding_page() + Setting.file_extension;
        },

        reset_margin_bottom_and_top: function() {
          this.element.style.marginTop    = window.innerHeight + "px";
          this.element.style.marginBottom = window.innerHeight + "px";
        },
      };

      var Page = {
        init: function() {
          (function(style) {
            style.margin         = "0px";
            style.background     = "linear-gradient( -45deg, #dddddd 25%, #eeeeee 25%, #eeeeee 50%, #dddddd 50%, #dddddd 75%, #eeeeee 75%, #eeeeee )";
            style.backgroundSize = "100px 100px";
          })(window.document.body.style);
        },

        get_hash: function() {
          return window.location.hash.substring(1);
        },

        get_page: function() {
          var page = parseInt(this.get_hash(), 10);

          if (isFinite(page) === false || page < 1) {
            page = 1;
          }

          return page;
        },

        zero_padding_string: function() {
          return this.zero_padding_string.cache || (this.zero_padding_string.cache = (function() {
            var result = "";

            for (var i = 0; i < Setting.zero_suppress_num; i++) {
              result += "0";
            }

            return result;
          })());
        },

        get_zero_padding_page: function() {
          return (this.zero_padding_string() + this.get_page()).slice(-Setting.zero_suppress_num);
        },

        hash_check_and_replace: function() {
          var page = String(this.get_page());

          if (this.get_hash() !== page) {
            window.history.replaceState(null, null, "#" + page);
          }
        },

        get_transition_page_num: function(event) {
          return (event.altKey || event.ctrlKey || event.metaKey || event.shiftKey) ? 10 : 1;
        },

        transition_page: function(page) {
          try {
            window.history.pushState(null, null, "#" + page);
          }
          catch(error) {
            // SecurityError (DOM Exception 18): Attempt to use history.pushState() more than 100 times per 30.000000 seconds
            // Nosy security message from safari ! ヽ(`Д´)ﾉ
            if (error.code === 18) {
              window.location.reload(false);
            }
            else {
              window.alert(error);
              throw error;
            }
          }
        },

        transition_next_page: function(event) {
          var replace_page = this.get_page() + this.get_transition_page_num(event);
          this.transition_page(replace_page);
          Image.update(this.scroll_top);
        },

        transition_previous_page: function(event) {
          var replace_page = this.get_page() - this.get_transition_page_num(event);

          if (replace_page < 1) {
            replace_page = 1;
          }

          this.transition_page(replace_page);
          Image.update(this.scroll_bottom);
        },

        scroll_top: function() {
          window.scrollTo(0, window.innerHeight);
        },

        scroll_bottom: function() {
          window.scrollTo(0, Image.element.height);
        },
      };

      var Event = {
        init: function() {
          this.set_resize_event_to_window();
          this.set_mousemove_event_to_window();
          this.set_click_event_to_window();
          this.set_keydown_event_to_window();
          this.set_popstate_event_to_window();
          this.set_load_event_to_image();
        },

        set_resize_event_to_window: function() {
          window.addEventListener("resize", function(event) {
            Image.reset_margin_bottom_and_top();
          }, false);
        },

        check_mouse_position: function(event) {
          return (event.clientX < window.innerWidth / 2);
        },

        set_mousemove_event_to_window: function() {
          var set_cursor = function(cursor_style) {
            window.document.body.style.cursor = cursor_style;
          };

          window.addEventListener("mousemove", function(event) {
            if (this.check_mouse_position(event)) {
              // カーソルが左半分にある / 左向きカーソル
              set_cursor("w-resize");
            }
            else {
              // カーソルが右半分にある / 右向きカーソル
              set_cursor("e-resize");
            }
          }.bind(this), false);
        },

        set_click_event_to_window: function() {
          window.addEventListener("click", function(event) {
            if (this.check_mouse_position(event)) {
              // 左半分クリック
              Page.transition_previous_page(event);
            }
            else {
              // 右半分クリック
              Page.transition_next_page(event);
            }
          }.bind(this), false);
        },

        set_keydown_event_to_window: function() {
          window.addEventListener("keydown", function(event) {
            // event.key           [Chrome, Firefox, Opera, MS-IE11, MS-Edge25]
            // event.keyIdentifier [Safari] (.keyIdentifier method is deprecated. However, .key method is not supported in Safari.)
            var received_key  = event.key || event.keyIdentifier;

            switch (received_key) {
              case "Enter":     // [Chrome, Firefox, Safari, Opera, MS-IE11, MS-Edge25]
              case "ArrowRight":// [Chrome, Firefox, Opera]
              case "Right":     // [Safari, MS-IE11, MS-Edge25]
                Page.transition_next_page(event);
                break;
              case "ArrowLeft": // [Chrome, Firefox, Opera]
              case "Left":      // [Safari, MS-IE11, MS-Edge25]
                Page.transition_previous_page(event);
                break;
            }
          }, false);
        },

        set_popstate_event_to_window: function() {
          window.addEventListener("popstate", function(event) {
            Page.hash_check_and_replace();
            Image.update(Page.scroll_top);
          }, false);
        },

        set_load_event_to_image: function() {
          Image.element.addEventListener("load", function(event) {
            Image.call_function_after_image_load();
          }, false);
        },
      };

      window.addEventListener("DOMContentLoaded", function() {
        Image.init();
        Page.init();
        Event.init();

        Page.hash_check_and_replace();
        Image.update(Page.scroll_top);
      }, false);
    })(window);
  </script>
</body>
</html>
