<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
</head>
<body>
  <script>
    (function() {
      "use strict";

      var Setting = {
        // e.g.
        // ./path/to/file_name_001.jpg
        file_path:         "./path/to/file_name_",
        zero_suppress_num: 3,
        file_extension:    ".jpg",
      };

      var Image = {
        init: function() {
          this.element = document.createElement("img");
          this.element.style.width = "100%";
          window.document.body.appendChild(this.element);

          this.reset_margin_bottom_and_top();
        },

        update: function(function_after_image_load) {
          Image.call_function_after_image_load = function_after_image_load;
          this.element.src = Setting.file_path + Page.get_zero_padding_page() + Setting.file_extension;
        },

        reset_margin_bottom_and_top: function() {
          this.element.style.marginTop    = window.innerHeight + "px";
          this.element.style.marginBottom = window.innerHeight + "px";
        },
      };

      var Page = {
        init: function() {
          window.document.body.style.margin         = "0px";
          window.document.body.style.background     = "linear-gradient( -45deg, #dddddd 25%, #eeeeee 25%, #eeeeee 50%, #dddddd 50%, #dddddd 75%, #eeeeee 75%, #eeeeee )";
          window.document.body.style.backgroundSize = "100px 100px";
        },

        get_hash: function() {
          return window.location.hash.substring(1);
        },

        get_page: function() {
          var page = parseInt(this.get_hash(), 10);

          if (isFinite(page) === false || page < 1) {
            page = 1;
          }

          return page;
        },

        zero_padding_string: new Array(Setting.zero_suppress_num).fill("0").join(""),

        get_zero_padding_page: function() {
          return (this.zero_padding_string + this.get_page()).slice(-Setting.zero_suppress_num);
        },

        hash_check_and_replace: function() {
          var page = String(this.get_page());

          if (this.get_hash() !== page) {
            window.history.replaceState(null, null, "#" + page);
          }
        },

        get_move_page_num: function(event) {
          return (event.altKey || event.ctrlKey || event.metaKey || event.shiftKey) ? 10 : 1;
        },

        move_page: function(page) {
          window.history.pushState(null, null, "#" + page);
        },

        move_next_page: function(event) {
          var replace_page = this.get_page() + this.get_move_page_num(event);
          this.move_page(replace_page);
          Image.update(Page.scroll_top);
        },

        move_previous_page: function(event) {
          var replace_page = this.get_page() - this.get_move_page_num(event);
          replace_page = Math.max(1, replace_page);
          this.move_page(replace_page);
          Image.update(Page.scroll_bottom);
        },

        scroll_top: function() {
          window.scrollTo(0, window.innerHeight);
        },

        scroll_bottom: function() {
          window.scrollTo(0, Image.element.height);
        },
      };

      var Event = {
        init: function() {
          this.set_resize();
          this.set_mousemove();
          this.set_mousedown();
          this.set_keydown();
          this.set_popstate();
          this.set_load();
        },

        set_resize: function() {
          window.addEventListener("resize", function(event) {
            Image.reset_margin_bottom_and_top();
          }, false);
        },

        check_mouse_position: function(event) {
          return (event.clientX < window.innerWidth / 2);
        },

        set_mousemove: function() {
          var set_cursor = function(cursor_style) {
            window.document.body.style.cursor = cursor_style;
          };

          window.addEventListener("mousemove", function(event) {
            if (this.check_mouse_position(event)) {
              // カーソルが左半分にある / 左向きカーソル
              set_cursor("w-resize");
            }
            else {
              // カーソルが右半分にある / 右向きカーソル
              set_cursor("e-resize");
            }
          }.bind(this), false);
        },

        set_mousedown: function() {
          window.addEventListener("mousedown", function(event) {
            if (this.check_mouse_position(event)) {
              // 左半分クリック
              Page.move_previous_page(event);
            }
            else {
              // 右半分クリック
              Page.move_next_page(event);
            }
          }.bind(this), false);
        },

        receive_key_list_and_exec_functions: {
          Enter:      Page.move_next_page,     // [chrome, firefox, safari]
          ArrowRight: Page.move_next_page,     // [chrome, firefox]
          ArrowLeft:  Page.move_previous_page, // [chrome, firefox]
          Right:      Page.move_next_page,     // [safari]
          Left:       Page.move_previous_page, // [safari]
        },

        set_keydown: function() {
          window.addEventListener("keydown", function(event) {
            // event.key           [chrome, firefox]
            // event.keyIdentifier [safari] (.keyIdentifier method is deprecated. However, .key method is not supported in safari.)

            var received_key  = event.key || event.keyIdentifier;
            var exec_function = this.receive_key_list_and_exec_functions[received_key];

            if (exec_function) {
              exec_function.call(Page, event);
              // memo
              // exec_function.bind(Page)(event);
              // exec_function.bind(Page, event)();
            }
          }.bind(this), false);
        },

        set_popstate: function() {
          window.addEventListener("popstate", function(event) {
            Page.hash_check_and_replace();
            Image.update(Page.scroll_top);
          }, false);
        },

        set_load: function() {
          Image.element.addEventListener("load", function(event) {
            Image.call_function_after_image_load();
          }, false);
        }
      };

      window.addEventListener("DOMContentLoaded", function() {
        Image.init();
        Page.init();
        Event.init();

        Page.hash_check_and_replace();
        Image.update(Page.scroll_top);
      }, false);
    })();
  </script>
</body>
</html>
