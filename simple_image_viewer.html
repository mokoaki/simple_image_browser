<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <script>
    (function(window) {
      "use strict";

      window.Siv = {
        setting: {
          // e.g.
          // ./path/to/file_name_001.jpg
          file_path:         "./path/to/file_name_",
          zero_suppress_num: 3,
          file_extension:    ".jpg",
        },

        initialize: function() {
          Siv.image.init();
          Siv.event.init();
          Siv.page.init();

          window.removeEventListener("DOMContentLoaded", Siv.initialize, false);

          delete Siv.initialize;
        },

        image: {
          init: function() {
            Siv.image.element = window.document.createElement("img");
            Siv.image.element.style.width = "100%";
            window.document.body.appendChild(Siv.image.element);

            Siv.image.reset_margin_bottom_and_top();

            delete Siv.image.init;
          },

          update: function(function_after_image_load) {
            Siv.image.call_function_after_image_load = function_after_image_load;
            Siv.image.element.src = Siv.setting.file_path + Siv.page.get_zero_padding_page() + Siv.setting.file_extension;
          },

          reset_margin_bottom_and_top: function() {
            Siv.image.element.style.marginTop    = window.innerHeight + "px";
            Siv.image.element.style.marginBottom = window.innerHeight + "px";
          },
        },

        page: {
          init: function() {
            (function(style) {
              style.margin         = "0px";
              style.background     = "linear-gradient( -45deg, #dddddd 25%, #eeeeee 25%, #eeeeee 50%, #dddddd 50%, #dddddd 75%, #eeeeee 75%, #eeeeee )";
              style.backgroundSize = "100px 100px";
            })(window.document.body.style);

            Siv.page.hash_check_and_replace();
            Siv.image.update(Siv.page.scroll_top);

            delete Siv.page.init;
          },

          get_hash: function() {
            return window.location.hash.substring(1);
          },

          get_page: function() {
            var page = parseInt(Siv.page.get_hash(), 10);

            if (isFinite(page) === false || page < 1) {
              page = 1;
            }

            return page;
          },

          zero_padding_string: function() {
            var result = "";

            for (var i = 0; i < Siv.setting.zero_suppress_num; i++) {
              result += "0";
            }

            Siv.page.zero_padding_string = function() {
              return result;
            };

            return result;
          },

          get_zero_padding_page: function() {
            return (Siv.page.zero_padding_string() + Siv.page.get_page()).slice(-Siv.setting.zero_suppress_num);
          },

          hash_check_and_replace: function() {
            var page = String(Siv.page.get_page());

            if (Siv.page.get_hash() !== page) {
              window.history.replaceState(null, null, "#" + page);
            }
          },

          get_transition_page_num: function(event) {
            return (event.altKey || event.ctrlKey || event.metaKey || event.shiftKey) ? 10 : 1;
          },

          transition_page: function(page) {
            try {
              window.history.pushState(null, null, "#" + page);
            }
            catch(error) {
              // SecurityError (DOM Exception 18): Attempt to use history.pushState() more than 100 times per 30.000000 seconds
              // Nosy security message from safari ! ヽ(`Д´)ﾉ
              if (error.code === 18) {
                window.location.reload(false);
              }
              else {
                window.alert(error);
                throw error;
              }
            }
          },

          transition_next_page: function(event) {
            var replace_page = Siv.page.get_page() + Siv.page.get_transition_page_num(event);
            Siv.page.transition_page(replace_page);
            Siv.image.update(Siv.page.scroll_top);
          },

          transition_previous_page: function(event) {
            var replace_page = Siv.page.get_page() - Siv.page.get_transition_page_num(event);

            if (replace_page < 1) {
              replace_page = 1;
            }

            Siv.page.transition_page(replace_page);
            Siv.image.update(Siv.page.scroll_bottom);
          },

          scroll: function(top) {
            window.scrollTo(0, top);
          },

          scroll_top: function() {
            Siv.page.scroll(window.innerHeight);
          },

          scroll_bottom: function() {
            Siv.page.scroll(Siv.image.element.height);
          },
        },

        event: {
          init: function() {
            Siv.event.set_resize_event_to_window();
            Siv.event.set_mousemove_event_to_window();
            Siv.event.set_click_event_to_window();
            Siv.event.set_keydown_event_to_window();
            Siv.event.set_popstate_event_to_window();
            Siv.event.set_load_event_to_image();

            delete Siv.event;
          },

          set_resize_event_to_window: function() {
            window.addEventListener("resize", function(event) {
              Siv.image.reset_margin_bottom_and_top();
            }, false);
          },

          set_mousemove_event_to_window: function() {
            window.addEventListener("mousemove", function(event) {
              if (event.clientX < window.innerWidth / 2) {
                // カーソルが左半分にある / 左向きカーソル
                window.document.body.style.cursor = "w-resize";
              }
              else {
                // カーソルが右半分にある / 右向きカーソル
                window.document.body.style.cursor = "e-resize";
              }
            }, false);
          },

          set_click_event_to_window: function() {
            window.addEventListener("click", function(event) {
              if (event.clientX < window.innerWidth / 2) {
                // 左半分クリック
                Siv.page.transition_previous_page(event);
              }
              else {
                // 右半分クリック
                Siv.page.transition_next_page(event);
              }
            }, false);
          },

          set_keydown_event_to_window: function() {
            window.addEventListener("keydown", function(event) {
              // event.key           [Chrome, Firefox, Opera, MS-IE11, MS-Edge25]
              // event.keyIdentifier [Safari] (.keyIdentifier method is deprecated. However, .key method is not supported in Safari.)
              var received_key  = event.key || event.keyIdentifier;

              switch (received_key) {
                case "Enter":     // [Chrome, Firefox, Safari, Opera, MS-IE11, MS-Edge25]
                case "ArrowRight":// [Chrome, Firefox, Opera]
                case "Right":     // [Safari, MS-IE11, MS-Edge25]
                  Siv.page.transition_next_page(event);
                  break;
                case "ArrowLeft": // [Chrome, Firefox, Opera]
                case "Left":      // [Safari, MS-IE11, MS-Edge25]
                  Siv.page.transition_previous_page(event);
                  break;
              }
            }, false);
          },

          set_popstate_event_to_window: function() {
            window.addEventListener("popstate", function(event) {
              Siv.page.hash_check_and_replace();
              Siv.image.update(Siv.page.scroll_top);
            }, false);
          },

          set_load_event_to_image: function() {
            Siv.image.element.addEventListener("load", function(event) {
              Siv.image.call_function_after_image_load();
            }, false);
          },
        }
      };

      window.addEventListener("DOMContentLoaded", Siv.initialize, false);
    })(window);
  </script>
</head>
<body>
</body>
</html>
